<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Learning API í´ë¼ì´ì–¸íŠ¸</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
    
    .section h2 {
      margin-top: 0;
      color: #555;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }
    
    input, textarea, button {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #0056b3;
    }
    
    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    
    .oauth-button {
      background-color: #4285f4;
      margin-bottom: 10px;
    }
    
    .oauth-button:hover {
      background-color: #357ae8;
    }
    
    .response {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 13px;
    }
    
    .response.success {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    
    .response.error {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .loading {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .user-info {
      background-color: #e7f3ff;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¤– AI Learning API í´ë¼ì´ì–¸íŠ¸</h1>
    
    <!-- ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ -->
    <div id="userInfo" class="user-info" style="display: none;">
      <strong>ë¡œê·¸ì¸ë¨:</strong> <span id="userEmail"></span>
      <button id="logoutBtn" style="width: auto; margin-left: 10px; padding: 5px 15px;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    
    <!-- Google OAuth ë¡œê·¸ì¸ -->
    <div class="section">
      <h2>ğŸ” Google OAuth ë¡œê·¸ì¸</h2>
      <button id="googleLoginBtn" class="oauth-button">Googleë¡œ ë¡œê·¸ì¸</button>
      <button id="checkAuthBtn">ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸</button>
      <div id="authResponse" class="response" style="display: none;"></div>
    </div>
    
    <!-- ë‹¨ì¼ ì§ˆë¬¸ -->
    <div class="section">
      <h2>â“ ChatGPTì— ì§ˆë¬¸í•˜ê¸°</h2>
      <div class="form-group">
        <label for="questionInput">ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
        <textarea id="questionInput" placeholder="ì˜ˆ: Node.jsì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”."></textarea>
      </div>
      <button id="askBtn">ì§ˆë¬¸í•˜ê¸°</button>
      <div id="askResponse" class="response" style="display: none;"></div>
    </div>
    
    <!-- ëŒ€í™”í˜• ì±„íŒ… -->
    <div class="section">
      <h2>ğŸ’¬ ëŒ€í™”í˜• ì±„íŒ…</h2>
      <div class="form-group">
        <label for="chatInput">ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
        <textarea id="chatInput" placeholder="ì•ˆë…•í•˜ì„¸ìš”! AIì™€ ëŒ€í™”í•´ë³´ì„¸ìš”."></textarea>
      </div>
      <button id="chatBtn">ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
      <button id="clearChatBtn" style="background-color: #6c757d; margin-top: 10px;">ëŒ€í™” ê¸°ë¡ ì´ˆê¸°í™”</button>
      <div id="chatHistory" style="margin-top: 15px;"></div>
    </div>
    
    <!-- API ìƒíƒœ í™•ì¸ -->
    <div class="section">
      <h2>ğŸ“Š API ìƒíƒœ</h2>
      <button id="healthBtn">OpenAI API ìƒíƒœ í™•ì¸</button>
      <button id="modelsBtn" style="margin-top: 10px;">ëª¨ë¸ ì •ë³´ ì¡°íšŒ</button>
      <div id="statusResponse" class="response" style="display: none;"></div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000';
    let chatMessages = [];
    let authToken = localStorage.getItem('authToken');
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    window.addEventListener('load', () => {
      checkAuthStatus();
      
      // URLì—ì„œ í† í° ì¶”ì¶œ (OAuth ì½œë°±ì—ì„œ ì˜¨ ê²½ìš°)
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      if (token) {
        authToken = token;
        localStorage.setItem('authToken', token);
        checkAuthStatus();
        // URLì—ì„œ í† í° ì œê±°
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });
    
    // API ìš”ì²­ í—¬í¼ í•¨ìˆ˜
    async function apiRequest(endpoint, options = {}) {
      try {
        const headers = {
          'Content-Type': 'application/json',
          ...options.headers
        };
        
        if (authToken) {
          headers['Authorization'] = `Bearer ${authToken}`;
        }
        
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
          ...options,
          headers
        });
        
        const data = await response.json();
        return { status: response.status, data };
      } catch (error) {
        return { status: 500, error: error.message };
      }
    }
    
    // ì‘ë‹µ í‘œì‹œ í•¨ìˆ˜
    function showResponse(elementId, result, isSuccess = true) {
      const element = document.getElementById(elementId);
      element.style.display = 'block';
      element.className = `response ${isSuccess ? 'success' : 'error'}`;
      element.textContent = JSON.stringify(result, null, 2);
    }
    
    // ë¡œë”© ìƒíƒœ ì„¤ì •
    function setLoading(buttonId, isLoading) {
      const button = document.getElementById(buttonId);
      if (isLoading) {
        button.disabled = true;
        button.innerHTML = '<span class="loading"></span>ì²˜ë¦¬ ì¤‘...';
      } else {
        button.disabled = false;
        button.innerHTML = button.getAttribute('data-original-text') || button.textContent.replace('ì²˜ë¦¬ ì¤‘...', '').replace('âŸ³', '');
      }
    }
    
    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    async function checkAuthStatus() {
      if (!authToken) return;
      
      const result = await apiRequest('/auth/verify-token', { method: 'POST' });
      
      if (result.status === 200) {
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('userEmail').textContent = result.data.user.email;
      } else {
        // í† í°ì´ ë¬´íš¨í•œ ê²½ìš° ì œê±°
        authToken = null;
        localStorage.removeItem('authToken');
        document.getElementById('userInfo').style.display = 'none';
      }
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.getElementById('googleLoginBtn').addEventListener('click', () => {
      window.location.href = `${API_BASE_URL}/auth/google`;
    });
    
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await apiRequest('/auth/logout', { method: 'POST' });
      authToken = null;
      localStorage.removeItem('authToken');
      document.getElementById('userInfo').style.display = 'none';
      alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
    
    document.getElementById('checkAuthBtn').addEventListener('click', async () => {
      setLoading('checkAuthBtn', true);
      const result = await apiRequest('/auth/status');
      setLoading('checkAuthBtn', false);
      showResponse('authResponse', result.data, result.status === 200);
    });
    
    document.getElementById('askBtn').addEventListener('click', async () => {
      const question = document.getElementById('questionInput').value.trim();
      if (!question) {
        alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      setLoading('askBtn', true);
      const result = await apiRequest('/api/ask', {
        method: 'POST',
        body: JSON.stringify({ question })
      });
      setLoading('askBtn', false);
      
      showResponse('askResponse', result.data, result.status === 200);
    });
    
    document.getElementById('chatBtn').addEventListener('click', async () => {
      const message = document.getElementById('chatInput').value.trim();
      if (!message) {
        alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
      chatMessages.push({ role: 'user', content: message });
      updateChatHistory();
      
      setLoading('chatBtn', true);
      const result = await apiRequest('/api/chat', {
        method: 'POST',
        body: JSON.stringify({ messages: chatMessages })
      });
      setLoading('chatBtn', false);
      
      if (result.status === 200) {
        // AI ì‘ë‹µ ì¶”ê°€
        chatMessages.push(result.data.message);
        updateChatHistory();
        document.getElementById('chatInput').value = '';
      } else {
        showResponse('chatHistory', result.data, false);
      }
    });
    
    document.getElementById('clearChatBtn').addEventListener('click', () => {
      chatMessages = [];
      updateChatHistory();
    });
    
    document.getElementById('healthBtn').addEventListener('click', async () => {
      setLoading('healthBtn', true);
      const result = await apiRequest('/api/health');
      setLoading('healthBtn', false);
      showResponse('statusResponse', result.data, result.status === 200);
    });
    
    document.getElementById('modelsBtn').addEventListener('click', async () => {
      setLoading('modelsBtn', true);
      const result = await apiRequest('/api/models');
      setLoading('modelsBtn', false);
      showResponse('statusResponse', result.data, result.status === 200);
    });
    
    // ì±„íŒ… íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
    function updateChatHistory() {
      const historyElement = document.getElementById('chatHistory');
      
      if (chatMessages.length === 0) {
        historyElement.innerHTML = '<p style="color: #666; font-style: italic;">ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      const historyHTML = chatMessages.map(msg => {
        const isUser = msg.role === 'user';
        const bgColor = isUser ? '#e3f2fd' : '#f3e5f5';
        const icon = isUser ? 'ğŸ‘¤' : 'ğŸ¤–';
        
        return `
          <div style="margin: 10px 0; padding: 12px; background: ${bgColor}; border-radius: 8px;">
            <strong>${icon} ${isUser ? 'ì‚¬ìš©ì' : 'AI'}:</strong><br>
            <span style="margin-top: 5px; display: block;">${msg.content}</span>
          </div>
        `;
      }).join('');
      
      historyElement.innerHTML = historyHTML;
    }
    
    // ì´ˆê¸° ì±„íŒ… íˆìŠ¤í† ë¦¬ ì„¤ì •
    updateChatHistory();
    
    // ë²„íŠ¼ì˜ ì›ë˜ í…ìŠ¤íŠ¸ ì €ì¥
    document.querySelectorAll('button').forEach(btn => {
      btn.setAttribute('data-original-text', btn.textContent);
    });
  </script>
</body>
</html> 